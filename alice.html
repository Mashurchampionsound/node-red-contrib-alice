<script defer src="https://www.gstatic.com/firebasejs/7.5.2/firebase-app.js"></script>
<script defer src="https://www.gstatic.com/firebasejs/7.5.2/firebase-auth.js"></script>

<script type="text/javascript">
    const firebaseConfig = {
            apiKey: "AIzaSyDQUn6EhNOgSAV15do8DKwwx3KHDyvLGJc",
            authDomain: "node-red-alice-4462f.firebaseapp.com",
            databaseURL: "https://node-red-alice-4462f.firebaseio.com",
            projectId: "node-red-alice-4462f",
            storageBucket: "node-red-alice-4462f.appspot.com",
            messagingSenderId: "1049686868440",
            appId: "1:1049686868440:web:e5f5ef6a70ead338b6f2ad",
            measurementId: "G-MD0L6R9N79"
        };
    RED.nodes.registerType('alice-service',{
        category: 'config',
        defaults: {
            name: {value:null}
        },
        credentials:{
            email: {type: "text", required:true},
            password: {type: "password", required:true}
        },
        label: function() {
            return this.name || "Alice-Credentials";
        },
        oneditsave: function(){
            nodename = $('#node-config-input-email').val();
            $('#node-config-input-name').val(nodename);
        }
    });
    function Activete(div){
        if (div=="singup"){
            document.getElementById("singin").hidden = true;
            document.getElementById("singup").hidden = false;
            document.getElementById("restore").hidden = true;
        }else if (div=="restore"){
            document.getElementById("singin").hidden = true;
            document.getElementById("singup").hidden = true;
            document.getElementById("restore").hidden = false;
        }else{
            document.getElementById("singin").hidden = false;
            document.getElementById("singup").hidden = true;
            document.getElementById("restore").hidden = true;
        };
    };
    function SingUp(){
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        };
        document.getElementById("register_error").innerHTML = "";
        var email = document.getElementById("register_email").value;
        var password = document.getElementById("register_password").value;
        firebase.auth().createUserWithEmailAndPassword(email, password)
            .then(function(r){
                document.getElementById("node-config-input-email").value = email;
                document.getElementById("node-config-input-password").value = password;
                Activete();
            })
            .catch(function(error) {
                document.getElementById("register_error").innerHTML = error.message;
            })
    };
    function Restore(){
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        };
        document.getElementById("restore_error").innerHTML = "";
        var emailAddress = document.getElementById("restore_email").value;
        firebase.auth().sendPasswordResetEmail(emailAddress).then(function() {
            alert("Password recovery email was sent successfully! Please check your email.");
            Activete();
        }).catch(function(error) {
            document.getElementById("restore_error").innerHTML = error.message;
        });
    }
</script>
<script>
       
</script>


<script type="text/x-red" data-template-name="alice-service">    
    <input type="hidden" id="node-config-input-name">
    <div id="singin" >
        <div class="form-row"><b>Credentials</b></div>
        <div class="form-row">
            <label for="node-config-input-email">Email</label>
            <input type="text" id="node-config-input-email" placeholder="user@example.com">
        </div>
        <div class="form-row">
            <label for="node-config-input-password">Password</label>
            <input type="password" id="node-config-input-password">
        </div>

        <div class="form-tips" style="margin-top:64px;">
            <b>Tip:</b>
            <p>If you don't have credentials, please <button class="ui-button" onclick="Activete('singup')">Register</button> before using </p>
            <p>If you forgot your password <button class="ui-button" onclick="Activete('restore')">Restore password</button></p>
        </div>
    </div>
    <div id="singup" hidden>
        <form>
            <div class="form-row"><b>Signup</b></div>
            <div class="form-row">
                <label>Email</label>
                <input type="text" id="register_email" placeholder="user@example.com">
            </div>
            <div class="form-row">
                <label> Password</label>
                <input type="password" id="register_password">
            </div>
            <div class="form-row" style="text-align: end; margin-right: 32px;">
                <button onclick="Activete()" class="ui-button">Cancel</button>
                <button onclick="SingUp()" class="ui-button primary">Signup</button>
            </div>
        </form>
        <p style="color:red;" id="register_error"></p>
    </div>
    <div id="restore" hidden>
        <div class="form-row"><b>Password recovery</b></div>
        <div class="form-row">
            <label> Email</label>
            <input type="text" id="restore_email" placeholder="user@example.com">
        </div>
        <div class="form-row" style="text-align: end; margin-right: 32px;">
                <button onclick="Activete()" class="ui-button">Cancel</button>
                <button onclick="Restore()" class="ui-button primary">Recover</button>
        </div>
        <p style="color:red;" id="restore_error"></p>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('alice-device',{
        category: 'config',
        defaults:{
            service: {value:"", type:"alice-service"},
            name: {value:null, required: true},
            description: {value:null},
            room: {value:"Комната"},
            dtype: {value:"devices.types.light", required: true}
        },
        label: function(){
            return this.room+":"+this.name || "Alice-Device";
        }
    })
</script>

<script type="text/x-red" data-template-name="alice-device">
    <div class="form-row">
        <label for="node-config-input-service">Credentials</label>
        <input id="node-config-input-service">
    </div>
    <div class="form-row">
        <label for="node-config-input-name">Name</label>
        <input type="text" id="node-config-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-config-input-description">Description</label>
        <input type="text" id="node-config-input-description" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-config-input-room">Room</label>
        <input type="text" id="node-config-input-room" placeholder="Room">
    </div>
    <div class="form-row">
        <label for="node-config-input-dtype">Type</label>
        <select id="node-config-input-dtype" style="width: 70%;">
            <option value="devices.types.light">Light</option>
            <option value="devices.types.socket">Socket</option>
            <option value="devices.types.switch" >Switch</option>
            <option value="devices.types.thermostat">Thermostat</option>
            <option value="devices.types.thermostat.ac">Air conditioning</option>
            <option value="devices.types.media_device">Multimedia</option>
            <option value="devices.types.media_device.tv">TV</option>
            <option value="devices.types.cooking">Kitchen appliances</option>
            <option value="devices.types.cooking.coffee_maker">Coffee machine</option>
            <option value="devices.types.cooking.kettle">Smart kettle</option>
            <option value="devices.types.openable">Door, gate, window, shutters</option>
            <option value="devices.types.openable.curtain">Curtains, blinds</option>
            <option value="devices.types.humidifier">Humidifier</option>
            <option value="devices.types.purifier">Air purifier</option>
            <option value="devices.types.vacuum_cleaner">Vacuum cleaner robot</option>
            <option value="devices.types.washing_machine">Washing machine</option>
            <option value="devices.types.other">Other</option>
        </select>
    </div>
</script>

<script type="text/javascript">
    RED.nodes.registerType('On_Off',{
        category: 'alice',
        defaults:{
            device: {value:"", type:"alice-device"},
            name: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "alice.png",
        color: "#D8BFD8",
        label: function(){
            return this.name + ":On/Off";
        },
        oneditsave: function(){
            deivcename = $('#node-input-device option:selected').text();
            $('#node-input-name').val(deivcename);
        }
    })
</script>

<script type="text/x-red" data-template-name="On_Off">
    <input type="hidden" id="node-input-name">
    <div class="form-row">
        <label for="node-input-device">Device</label>
        <input id="node-input-device">
    </div>
</script>

<script type="text/x-red" data-help-name="On_Off">
    <p>Allows the device to turn on and off</p>
    
    <h3>Property</h3>
    <dl class="message-properties">
        <dt>Device
            <span class="property-type">Select</span>
        </dt>
        <dd> The device to which this feature is connected </dd>
    </dl>

    <h3>Inputs</h3>
        <dl class="message-properties">
            <dt>payload
                <span class="property-type">boolean</span>
            </dt>
            <dd> true or false </dd>
        </dl>
    
     <h3>Outputs</h3>
         <dl class="message-properties">
            <dt>payload
                <span class="property-type">boolean</span>
            </dt>
            <dd> true or false </dd>
        </dl>
    <h3>References</h3>
        <ul>
            <li><a href="https://yandex.ru/dev/dialogs/alice/doc/smart-home/concepts/capability-types-docpage/"> - Yandex documentation</a></li>
        </ul>
    </script>

    <script type="text/javascript">
        RED.nodes.registerType('Toggle',{
            category: 'alice',
            defaults:{
                device: {value:"", type:"alice-device"},
                name: {value:""},
                instance: {value:"backlight"}
            },
            inputs:1,
            outputs:1,
            icon: "alice.png",
            color: "#D8BFD8",
            label: function(){
                return this.name + ":"+this.instance;
            },
            oneditsave: function(){
                deivcename = $('#node-input-device option:selected').text();
                $('#node-input-name').val(deivcename);
            }
        })
    </script>
    
    <script type="text/x-red" data-template-name="Toggle">
        <input type="hidden" id="node-input-name">
        <div class="form-row">
            <label for="node-input-device">Device</label>
            <input id="node-input-device">
        </div>
        <div class="form-row">
            <label for="node-input-instance">Instance</label>
            <select id="node-input-instance" style="width: 70%;">
                <option value="backlight">Backlight</option>
                <option value="controls_locked">Locking</option>
                <option value="ionization" >Ionization</option>
                <option value="keep_warm">Keep warm</option>
                <option value="mute">Mute</option>
                <option value="oscillation">Oscillation</option>
                <option value="pause">Pause</option>
            </select>
        </div>
    </script>
    
    <script type="text/x-red" data-help-name="Toggle">
        <p>Manage device settings that can only be in one of two states.</p>
        <p>The toggle skill has features. Functions are characterized by certain parameters and 
            voice scripts that allow you to describe the corresponding skills of the device.</p>
        
        <h3>Property</h3>
        <dl class="message-properties">
            <dt>Device
                <span class="property-type">Select</span>
            </dt>
            <dd> The device to which this feature is connected </dd>
            <dt>Instance
                <span class="property-type">Select</span>
            </dt>
            <dd> The name of the function for this skill. Affects which voice command is called </dd>
        </dl>
    
        <h3>Inputs</h3>
            <dl class="message-properties">
                <dt>payload
                    <span class="property-type">boolean</span>
                </dt>
                <dd> true or false </dd>
            </dl>
        
         <h3>Outputs</h3>
             <dl class="message-properties">
                <dt>payload
                    <span class="property-type">boolean</span>
                </dt>
                <dd> true or false </dd>
            </dl>
        <h3>References</h3>
            <ul>
                <li><a href="https://yandex.ru/dev/dialogs/alice/doc/smart-home/concepts/toggle-instance-docpage/"> - Yandex documentation</a></li>
            </ul>
        </script>

    <script type="text/javascript">
                RED.nodes.registerType('Color',{
                    category: 'alice',
                    defaults:{
                        device: {value:"", type:"alice-device"},
                        name: {value:""},
                        scheme: {value:"rgb"}
                    },
                    inputs:1,
                    outputs:1,
                    icon: "alice.png",
                    color: "#D8BFD8",
                    label: function(){
                        return this.name + ":Color";
                    },
                    oneditsave: function(){
                        deivcename = $('#node-input-device option:selected').text();
                        $('#node-input-name').val(deivcename);
                    }
                })
    </script>
            
    <script type="text/x-red" data-template-name="Color">
                <input type="hidden" id="node-input-name">
                <div class="form-row">
                    <label for="node-input-device">Device</label>
                    <input id="node-input-device">
                </div>
                <div class="form-row">
                    <label for="node-input-scheme">Scheme</label>
                    <select id="node-input-scheme" style="width: 70%;">
                        <option value="rgb">RGB</option>
                        <option value="hsv">HSV</option>
                    </select>
                </div>
    </script>
            
    <script type="text/x-red" data-help-name="Color">
                <p>Change the color of their luminous elements to any one from the HSV model or from the RGB model;</p>
                
                <h3>Property</h3>
                <dl class="message-properties">
                    <dt>Device
                        <span class="property-type">Select</span>
                    </dt>
                    <dd> The device to which this feature is connected </dd>
                    <dt>Scheme
                        <span class="property-type">Select</span>
                    </dt>
                    <dd> Color scheme selection (RGB or HSV) </dd>
                </dl>
            
                <h3>Inputs</h3>
                    <dl class="message-properties">
                        <dt>payload
                            <span class="property-type">Object || Integer</span>
                        </dt>
                        <dd> If the color scheme is RGB, then payload must be presented in 24-bit format (<a href="https://ru.wikipedia.org/wiki/TrueColor" target="_blank">TrueColor</a>). </dd>
                        <dd> If the color scheme is HSV, then payload HSV Object (hue,saturation,value) </br><i>{h:Integer,s:Integer,v:Integer}</i></dd>
                    </dl>
                
                 <h3>Outputs</h3>
                    <dl class="message-properties">
                        <dt>payload
                            <span class="property-type">Object || Integer</span>
                        </dt>
                        <dd> If the color scheme is RGB, then payload must be presented in 24-bit format (<a href="https://ru.wikipedia.org/wiki/TrueColor" target="_blank">TrueColor</a>). </dd>
                        <dd> If the color scheme is HSV, then payload HSV Object (hue,saturation,value) </br><i>{h:Integer,s:Integer,v:Integer}</i></dd>
                    </dl>
                <h3>References</h3>
                    <ul>
                        <li><a href="https://yandex.ru/dev/dialogs/alice/doc/smart-home/concepts/color_setting-docpage/"> Yandex documentation</a></li>
                    </ul>
    </script>