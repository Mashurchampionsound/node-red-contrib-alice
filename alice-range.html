<script type="text/javascript">
    RED.nodes.registerType('Range',{
        category: 'alice',
        defaults:{
            device: {value:"", type:"alice-device"},
            name: {value:""},
            instance: {value:"brightness"},
            unit: {value:""},
            min:{value:1},
            max:{value:100},
            precision:{value: 1}
        },
        inputs:1,
        outputs:1,
        icon: "alice.png",
        color: "#D8BFD8",
        label: function(){
            return this.name + ":"+this.instance;
        },
        oneditsave: function(){
            deivcename = $('#node-input-device option:selected').text();
            $('#node-input-name').val(deivcename);
        },
        oneditprepare: function(){
            var firstRun = true;
            function instanceChange(inst){
                switch (inst) {
                    case 'brightness':
                        $('#node-input-unit').replaceWith('<select id="node-input-unit" style="width: 70%;"></select>');
                        $('#node-input-unit').append('<option value="unit.percent">%</option>');
                        $('#node-input-unit select').val("unit.percent");
                        $('#node-input-unit').prop( "disabled", true );
                        $('#node-input-min').val(0);
                        $('#node-input-max').val(100);
                        $('#node-input-precision').val(10);
                    break;
                    case 'channel':
                        $('#node-input-unit').replaceWith('<select id="node-input-unit" style="width: 70%;"></select>');
                        $('#node-input-unit').append('<option value="unit.number">Number</option>');
                        $('#node-input-unit select').val("unit.number");
                        $('#node-input-unit').prop( "disabled", true );
                        $('#node-input-min').val(0);
                        $('#node-input-max').val(1000);
                        $('#node-input-precision').val(1);
                    break;
                    case 'humidity':
                        $('#node-input-unit').replaceWith('<select id="node-input-unit" style="width: 70%;"></select>');
                        $('#node-input-unit').append('<option value="unit.percent">%</option>');
                        $('#node-input-unit select').val("unit.percent");
                        $('#node-input-unit').prop( "disabled", true );
                        $('#node-input-min').val(0);
                        $('#node-input-max').val(100);
                        $('#node-input-precision').val(10);
                    break;
                    case 'open':
                        $('#node-input-unit').replaceWith('<select id="node-input-unit" style="width: 70%;"></select>');
                        $('#node-input-unit').append('<option value="unit.percent">%</option>');
                        $('#node-input-unit select').val("unit.percent");
                        $('#node-input-unit').prop( "disabled", true );
                        $('#node-input-min').val(0);
                        $('#node-input-max').val(100);
                        $('#node-input-precision').val(10);
                    break;
                    case 'temperature':
                        $('#node-input-unit').replaceWith('<select id="node-input-unit" style="width: 70%;"></select>');
                        $('#node-input-unit').append('<option value="unit.temperature.celsius">Celsius (C)</option>');
                        $('#node-input-unit').append('<option value="unit.temperature.kelvin">Kelvin (K)</option>');
                        $('#node-input-unit select').val("unit.temperature.celsius");
                        $('#node-input-unit').prop( "disabled", false );
                        $('#node-input-min').val(0);
                        $('#node-input-max').val(100);
                        $('#node-input-precision').val(2);
                    break;
                    case 'volume':
                    $('#node-input-unit').replaceWith('<select id="node-input-unit" style="width: 70%;"></select>');
                        $('#node-input-unit').append('<option value="unit.number">Number</option>');
                        $('#node-input-unit select').val("unit.number");
                        $('#node-input-unit').prop( "disabled", true );
                        $('#node-input-min').val(0);
                        $('#node-input-max').val(100);
                        $('#node-input-precision').val(3);
                    break;
                }
            }

            $('#node-input-instance').on('change',()=>{
                var val = $('#node-input-instance').find(":selected").val();
                instanceChange(val);
            })
        }
    })
</script>

<script type="text/x-red" data-template-name="Range">
    <input type="hidden" id="node-input-name">
    <div class="form-row">
        <label for="node-input-device">Device</label>
        <input id="node-input-device">
    </div>
    <div class="form-row">
        <label for="node-input-instance">Range Type</label>
        <select id="node-input-instance" style="width: 70%;">
            <option value="brightness">Brightness</option>
            <option value="channel">Channel</option>
            <option value="humidity">Humidity</option>
            <option value="open">Open</option>
            <option value="temperature">Temperature</option>
            <option value="volume">Volume</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-unit">Unit</label>
        <select id="node-input-unit" style="width: 70%;">
            <option value="unit.temperature.celsius">Celsius</option>
            <option value="unit.temperature.kelvin">Kelvin</option>
            <option value="unit.percent">Percent</option>
        </select>
    </div>
    <div class="form-row">
        <label for="node-input-min">Min</label>
        <input type="number" id="node-input-min">
    </div>
    <div class="form-row">
        <label for="node-input-max">Max</label>
        <input type="number" id="node-input-max">
    </div>
    <div class="form-row">
        <label for="node-input-precision">Step</label>
        <input type="number" id="node-input-precision">
    </div>
</script>

<script type="text/x-red" data-help-name="Range">
    <p>Change the color of their luminous elements to any one from the HSV model or from the RGB model;</p>
    
    <h3>Property</h3>
    <dl class="message-properties">
        <dt>Device
            <span class="property-type">Select</span>
        </dt>
        <dd> The device to which this feature is connected </dd>
        <dt>Scheme
            <span class="property-type">Select</span>
        </dt>
        <dd> Color scheme selection (RGB or HSV) </dd>
    </dl>

    <h3>Inputs</h3>
        <dl class="message-properties">
            <dt>payload
                <span class="property-type">Object || Integer</span>
            </dt>
            <dd> If the color scheme is RGB, then payload must be presented in 24-bit format (<a href="https://ru.wikipedia.org/wiki/TrueColor" target="_blank">TrueColor</a>). </dd>
            <dd> If the color scheme is HSV, then payload HSV Object (hue,saturation,value) </br><i>{h:Integer,s:Integer,v:Integer}</i></dd>
        </dl>
    
     <h3>Outputs</h3>
        <dl class="message-properties">
            <dt>payload
                <span class="property-type">Object || Integer</span>
            </dt>
            <dd> If the color scheme is RGB, then payload must be presented in 24-bit format (<a href="https://ru.wikipedia.org/wiki/TrueColor" target="_blank">TrueColor</a>). </dd>
            <dd> If the color scheme is HSV, then payload HSV Object (hue,saturation,value) </br><i>{h:Integer,s:Integer,v:Integer}</i></dd>
        </dl>
    <h3>References</h3>
        <ul>
            <li><a href="https://yandex.ru/dev/dialogs/alice/doc/smart-home/concepts/color_setting-docpage/"> Yandex documentation</a></li>
        </ul>
</script>